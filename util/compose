#!/bin/bash

# ------------------------------------------------------------- #
#                 Obliging Ode & Unsung Anthem
# ------------------------------------------------------------- #
#
# This source file is part of the Obliging Ode and Unsung Anthem
# projects.
#
# Copyright (c) 2019 Antti Kivi
# All rights reserved
#
# ------------------------------------------------------------- #

readonly PRINT_DEBUG_OPTION="--print-debug"

for arg in "$@"; do
  if [[ "$arg" == "$PRINT_DEBUG_OPTION" ]]; then
    set -x
  fi
done

readonly ROOT_DIR="."
readonly BUILD_DIRECTORY_NAME="build"
readonly BUILD_DIRECTORY="$ROOT_DIR/$BUILD_DIRECTORY_NAME"

readonly PRESET_MODE_ARGUMENT="preset"
readonly COMPOSE_MODE_ARGUMENT="compose"

readonly COMPOSER_EXECUTABLE_NAME="composer"

# See if the directory generated by configuring mode is in place

if [[ ! -d "$BUILD_DIRECTORY" ]]; then
  echo "The build directory wasn't found; please make sure to run the \
cofiguring script before attempting to build Obliging Ode and Unsung \
Anthem" 1>&2
  exit 1
fi

# Run the script

preset_mode=false

for arg in "$@"; do
  if [[ "$arg" == "$PRESET_MODE_ARGUMENT" ]]; then
    preset_mode=true
  fi
done

if [[ $preset_mode == true ]]; then
  # $COMPOSER_EXECUTABLE_NAME $PRESET_MODE_ARGUMENT "$@" $COMPOSE_MODE_ARGUMENT
  $COMPOSER_EXECUTABLE_NAME "$@" $COMPOSE_MODE_ARGUMENT
else
  $COMPOSER_EXECUTABLE_NAME $COMPOSE_MODE_ARGUMENT "$@"
fi
