#!/bin/sh

# ---------------------------------------------------------------------------- #
#                         Obliging Ode & Unsung Anthem
# ---------------------------------------------------------------------------- #
#
# This source file is part of the Obliging Ode and Unsung Anthem projects.
#
# Copyright (c) 2019 Antti Kivi
# All rights reserved
#
# ---------------------------------------------------------------------------- #

set -e

readonly BASEDIR="$(dirname "$0")"

. $BASEDIR/composer/variables
. $BASEDIR/composer/functions

set_printing_mode $@

# Clean the script if clean build is enabled

clean_build="$(is_clean_build "$@")"

if [ "$clean_build" = true ] && [ -d "$COMPOSER_DIRECTORY" ]; then
  rm -rf $COMPOSER_DIRECTORY
fi

# Set up Couplet Composer

set_up_composer

# Run the script

preset_mode=false

for arg in "$@"; do
  if [ "$arg" = "$PRESET_MODE_ARGUMENT" ]; then
    preset_mode=true
  fi
done

if [ "$preset_mode" = true ]; then
  # $composer_executable $PRESET_MODE_ARGUMENT "$@" $CONFIGURE_MODE_ARGUMENT
  $composer_executable "$@" $CONFIGURE_MODE_ARGUMENT
else
  $composer_executable $CONFIGURE_MODE_ARGUMENT "$@"
fi
