#===----------------------------- .travis.yml ------------------------------===#
#
#                         Obliging Ode & Unsung Anthem
#
# This source file is part of the Obliging Ode and Unsung Anthem open source
# projects.
#
# Copyright (c) 2019 Antti Kivi
# Licensed under GNU Affero General Public License v3.0

language: cpp

sudo: false

env:
  global:
  - secure: erCEE82Y/n+pFU9e9pAY6yJedCktMOznVPz2fLvsbR7T9KxXdKaB57LszVe2DSCVSs/1R+2Lnzq3PVB+cuZxgSVhRjTagekZl88OmncrhZfjKsyU2WqrzjKdwzhk67FdPXofwt/ZmM6cRjMu9WbRsoR1X+0jZ0S9el044QSR5Sv/71Shes0SEAvNw61NRTBKoDxJT1mY41aPSscxt8PugC/OReRV9q2m2Uuzg66qA6qi3Iqmii6t41yhDFWnl53vE308RY0dDvW+db+hbTUTLLMrmnvdx0zq5bd2rmL+4/VfxdgCrXs6fawzR/n4MtVdBrZP4iEEkTzTxOCCqFOhPpTKIhfLd8y1xRZQXJMaWs/J+01MFON4sPhqrHnF1roy7f8GpwYScMSTm7d6h9ghUAOEyb2GIEQqwWqJrVYk0RWC0+bDxvGJA2+O3xg2z7ETOMRtPtamQY8rPt6PapPCiXjH+Z8TAP59cA/lH94OjorCX2r/540j4krCPOhSyvo+74t9S+YLWSDzeaBma2WKC+GK9vk74JY4DCEF9wX2ZJhlS+dVhv8yzxa7IswcrdTS1DMf4bEjcXMl5XMocAdCJecolpXTh92mIb5lShLHgwwCY5D/yvQSsnCBG1QZknJvWJOMbHmuzmR2eyYo2V3BiHw69Wq6uRT+3A0BZ7p9+Yo=
  - secure: 0XGde/2ZAsVkWQH63EuAoizqVk4qAfV86QF2pWwI45vaRL1IACakAebiCeXcG3u2vb8lYTtM3aoWQKu5ksbZQmaOvj/+u8CsTEMd0Y6GguRcQPBsd+4tIHXAvhGfyEr6QWxNDj0v9uP+R/okQwzNfFMzNwy/9KSrvgHlKbTd8AdOU5jtsRdhScaXLHTpd+okxbE99s16kzGlFgFyrkbVJ0THeyhBlLK5qnHIxefcO5K378hlqh1EgkAbX7ovU13eFVi07xV9jODjOB4lChBzCf02MQHYV6WrlN0qO8aipK4BCjjK3C0uJcu4pasbzbKF1/VNiHaPvrmzeVJqC+Bvys1rVbI+0FNHPMB1xf76cOnXo+ENZNnubKuFFAN86bQP81NXKyqse+Qs5gsLs4zSwjzSl3LvtCzqvgfjeFCV3AMIG5T4QOBCvKeKm9mOeJiYlQy7BimiUs7EQ5evE9oQ3vB9N5wYw0rA2J3nNCP24Q+3gM4SQbwh6BpC4BM2S+iqKsrzd7xXaVeLWkbTZMWR5BSn5WGV11ITjGXXacIs+Wa507KyVbQSSpfe1ZNCP5NP6La3+p6g6bNjyDR0p3RnLF0UuQiApltLbo+r6dqk9Vyc2WzznNLHPyH1uUJ3MvqHbabzRg4VOPo9xe4kvPIaDkFz2u21MhD93GavGJ05Odk=

matrix:
  include:

  #===----------------------------------------------------------------------===#
  #==- Linux - GCC ----------------------------------------------------------==#
  #===----------------------------------------------------------------------===#

  # Linux: Ubuntu Trusty 14.04 C++17 GCC 7
  # - os: linux
  #   dist: trusty
  #   compiler: gcc
  #   env:
  #   - COMPILER_NAME=gcc
  #   - CXX=g++-7
  #   - CC=gcc-7
  #   - BUILD_PRESET=travis_linux_gcc7_cxx17
  #   - ENABLE_COVERAGE=false
  #   addons:
  #     apt:
  #       packages:
  #       - g++-7
  #       - xorg-dev
  #       - libglu1-mesa-dev
  #       - build-essential
  #       sources: &sources
  #       - ubuntu-toolchain-r-test

  # Linux: Ubuntu Trusty 14.04 C++17 GCC 7 with Make
  - os: linux
    dist: trusty
    compiler: gcc
    env:
    - COMPILER_NAME=gcc
    - CXX=g++-7
    - CC=gcc-7
    - BUILD_PRESET=travis_linux_gcc7_cxx17_make
    - ENABLE_COVERAGE=false
    addons:
      apt:
        packages:
        - g++-7
        - xorg-dev
        - libglu1-mesa-dev
        - build-essential
        sources: &sources
        - ubuntu-toolchain-r-test

  # Linux: Ubuntu Trusty 14.04 C++17 GCC 7 + Coverage
  - os: linux
    dist: trusty
    compiler: gcc
    env:
    - COMPILER_NAME=gcc
    - CXX=g++-7
    - CC=gcc-7
    - BUILD_PRESET=travis_linux_gcc7_cxx17_coverage
    - ENABLE_COVERAGE=true
    addons:
      apt:
        packages:
        - g++-7
        - xorg-dev
        - libglu1-mesa-dev
        - build-essential
        - lcov
        sources: *sources

  #===----------------------------------------------------------------------===#
  #==- Linux - Clang --------------------------------------------------------==#
  #===----------------------------------------------------------------------===#

  # Linux: Ubuntu Trusty 14.04 C++17 Clang 6.0
  - os: linux
    dist: trusty
    compiler: clang
    env:
    - COMPILER_NAME=clang
    - CXX=clang++
    - CC=clang
    - BUILD_PRESET=travis_linux_clang60_cxx17
    - ENABLE_COVERAGE=false
    addons:
      apt:
        packages:
        - xorg-dev
        - libglu1-mesa-dev
        - build-essential
        sources: *sources

  #===----------------------------------------------------------------------===#
  #==- Darwin - Apple Clang -------------------------------------------------==#
  #===----------------------------------------------------------------------===#

  # Darwin: macOS 10.10 Xcode 6.4 C++17 Clang
  # - os: osx
  #   osx_image: xcode6.4
  #   compiler: clang
  #   env:
  #   - COMPILER_NAME=clang
  #   - CXX=clang++
  #   - CC=clang
  #   - BUILD_PRESET=travis_darwin_xcode64_clang_cxx17
  #   - ENABLE_COVERAGE=false
  #   - ODE_PYTHON=python3
  #   - ODE_PIP=pip3

  # Darwin: macOS 10.11 Xcode 7.3.1 C++17 Clang
  - os: osx
    osx_image: xcode7.3
    compiler: clang
    env:
    - COMPILER_NAME=clang
    - CXX=clang++
    - CC=clang
    - BUILD_PRESET=travis_darwin_xcode73_clang_cxx17
    - ENABLE_COVERAGE=false

  # Darwin: macOS 10.12 Xcode 8.3.3 C++17 Clang
  - os: osx
    osx_image: xcode8.3
    compiler: clang
    env:
    - COMPILER_NAME=clang
    - CXX=clang++
    - CC=clang
    - BUILD_PRESET=travis_darwin_xcode83_clang_cxx17
    - ENABLE_COVERAGE=false
    - ODE_PYTHON=python2
    - ODE_PIP=pip2

  # Darwin: macOS 10.13 Xcode 9.3 beta C++17 Clang
  - os: osx
    osx_image: xcode9.3beta
    compiler: clang
    env:
    - COMPILER_NAME=clang
    - CXX=clang++
    - CC=clang
    - BUILD_PRESET=travis_darwin_xcode93_clang_cxx17
    - ENABLE_COVERAGE=false

before_install:
- cd $TRAVIS_BUILD_DIR/..
- chmod +x unsung-anthem/utils/travis/before_install.sh
- ./unsung-anthem/utils/travis/before_install.sh

install:
- cd $TRAVIS_BUILD_DIR/..
- chmod +x unsung-anthem/utils/travis/install.sh
- ./unsung-anthem/utils/travis/install.sh

script:
- cd $TRAVIS_BUILD_DIR/..
- chmod +x unsung-anthem/utils/travis/script.sh
- ./unsung-anthem/utils/travis/script.sh

after_script:
- cd $TRAVIS_BUILD_DIR
- chmod +x utils/travis/after_script.sh
- ./utils/travis/after_script.sh
